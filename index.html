<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ramadan Quran Tracker</title>
  
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    * { font-family: 'Plus Jakarta Sans', sans-serif; }
    :root { 
      --primary: #10b981; 
      --accent: #059669; 
      --bg: #f8fafc; 
      --surface: #ffffff;
      --border: #f1f5f9;
    }
    body { background-color: var(--bg); color: #1e293b; }
    
    .glass-nav {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    
    .card-dashboard {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card-dashboard:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px -10px rgba(0, 0, 0, 0.05);
    }

    .input-field {
      border: 1.5px solid #e2e8f0;
      border-radius: 12px;
      transition: all 0.2s;
    }

    .input-field:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
      outline: none;
    }

    .nav-tab {
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tab-active {
      background-color: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
    }

    .tab-inactive {
      color: #64748b;
    }

    .tab-inactive:hover {
      background-color: #f1f5f9;
      color: #1e293b;
    }

    .header-gradient {
      background: linear-gradient(135deg, #064e3b 0%, #10b981 100%);
    }

    /* Hide scrollbar but keep functionality */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="h-full">
  <div class="min-h-screen pb-24">
    <header class="header-gradient pt-10 pb-20 px-6 text-center text-white shadow-lg">
      <div class="max-w-4xl mx-auto">
        <div class="inline-flex items-center justify-center p-3 bg-white/20 rounded-2xl mb-4 backdrop-blur-sm">
          <i class="fas fa-quran text-2xl"></i>
        </div>
        <h1 class="text-3xl font-extrabold tracking-tight">Ramadan Quran Hub</h1>
        <p class="text-emerald-50 mt-2 opacity-90 font-medium">Monitoring Progres Tilawah Harian</p>
      </div>
    </header>

    <nav class="glass-nav sticky top-4 mx-4 md:mx-auto max-w-2xl mt-[-32px] p-2 rounded-2xl border border-white/50 shadow-xl z-50 overflow-x-auto no-scrollbar">
      <div class="flex items-center justify-between gap-1 min-w-max">
        <div onclick="showSection('dashboard')" id="tab-dashboard" class="nav-tab tab-active">
          <i class="fas fa-chart-pie"></i> Dashboard
        </div>
        <div onclick="showSection('form')" id="tab-form" class="nav-tab tab-inactive">
          <i class="fas fa-plus-circle"></i> Lapor
        </div>
        <div onclick="showSection('leaderboard')" id="tab-leaderboard" class="nav-tab tab-inactive">
          <i class="fas fa-award"></i> Peringkat
        </div>
        <div onclick="showSection('history')" id="tab-history" class="nav-tab tab-inactive">
          <i class="fas fa-history"></i> Riwayat
        </div>
      </div>
    </nav>

    <main class="max-w-4xl mx-auto px-6 mt-8">
      
      <section id="section-dashboard" class="space-y-6 animate-in fade-in duration-500">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="card-dashboard p-6 flex flex-col items-center justify-center text-center">
            <span class="p-3 bg-emerald-50 text-emerald-600 rounded-xl mb-3"><i class="fas fa-file-signature text-xl"></i></span>
            <div id="stat-total" class="text-3xl font-bold text-slate-800">0</div>
            <div class="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1">Total Laporan</div>
          </div>
          <div class="card-dashboard p-6 flex flex-col items-center justify-center text-center border-b-4 border-b-amber-400">
            <span class="p-3 bg-amber-50 text-amber-600 rounded-xl mb-3"><i class="fas fa-crown text-xl"></i></span>
            <div id="stat-khatam" class="text-3xl font-bold text-slate-800">0</div>
            <div class="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1">Peserta Khatam</div>
          </div>
          <div class="card-dashboard p-6 flex flex-col items-center justify-center text-center">
            <span class="p-3 bg-blue-50 text-blue-600 rounded-xl mb-3"><i class="fas fa-calendar-check text-xl"></i></span>
            <div id="stat-today" class="text-3xl font-bold text-slate-800">0</div>
            <div class="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1">Laporan Hari Ini</div>
          </div>
        </div>

        <div class="card-dashboard p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-bold text-slate-700 flex items-center gap-2">
              <i class="fas fa-tasks text-emerald-500"></i> Progres Keseluruhan
            </h3>
            <span id="prog-pct" class="text-sm font-bold text-emerald-600 bg-emerald-50 px-3 py-1 rounded-full">0%</span>
          </div>
          <div class="h-4 bg-slate-100 rounded-full overflow-hidden">
            <div id="prog-bar" class="h-full bg-emerald-500 transition-all duration-1000 ease-out shadow-[0_0_12px_rgba(16,185,129,0.4)]" style="width:0%"></div>
          </div>
        </div>

        <div class="card-dashboard p-6">
          <h3 class="font-bold text-slate-700 mb-5 flex items-center gap-2">
            <i class="fas fa-bolt text-amber-500"></i> Laporan Terbaru
          </h3>
          <div id="recent-list" class="space-y-4 text-sm">
            </div>
        </div>
      </section>

      <section id="section-form" class="hidden animate-in slide-in-from-bottom-4 duration-500">
        <div class="card-dashboard p-8 max-w-xl mx-auto shadow-2xl">
          <div class="text-center mb-8">
            <h2 class="text-2xl font-bold text-slate-800">Input Tilawah</h2>
            <p class="text-slate-400 text-sm mt-1">Lengkapi data bacaan harian Anda</p>
          </div>
          <form id="report-form" class="space-y-5">
            <div class="space-y-1">
              <label class="text-xs font-bold text-slate-500 uppercase ml-1">Nama Lengkap</label>
              <select id="f-nama" required class="input-field w-full p-4 bg-white text-slate-700 font-medium cursor-pointer">
                <option value="">Pilih Nama...</option>
              </select>
            </div>
            
            <div class="space-y-1">
              <label class="text-xs font-bold text-slate-500 uppercase ml-1">Kelompok</label>
              <input type="text" id="f-klp" readonly class="input-field w-full p-4 bg-slate-50 text-slate-500 font-medium" placeholder="Otomatis terisi">
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div class="space-y-1">
                <label class="text-xs font-bold text-slate-500 uppercase ml-1">Hari Ke-</label>
                <input type="number" id="f-hari" required class="input-field w-full p-4" placeholder="Contoh: 1">
              </div>
              <div class="space-y-1">
                <label class="text-xs font-bold text-slate-500 uppercase ml-1">Tanggal</label>
                <input type="date" id="f-tgl" required class="input-field w-full p-4">
              </div>
            </div>

            <div class="space-y-1">
              <label class="text-xs font-bold text-slate-500 uppercase ml-1">Jumlah Juz</label>
              <div class="relative">
                <input type="number" step="0.5" id="f-juz" required class="input-field w-full p-4 pl-12" placeholder="0.5 atau 1">
                <i class="fas fa-book-open absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
              </div>
            </div>

            <div class="space-y-1">
              <label class="text-xs font-bold text-slate-500 uppercase ml-1">Catatan Singkat</label>
              <textarea id="f-catatan" rows="2" class="input-field w-full p-4" placeholder="Opsional..."></textarea>
            </div>

            <button type="submit" id="f-btn" class="btn-primary w-full py-4 font-bold text-lg shadow-xl active:scale-95 transition-transform flex items-center justify-center gap-3">
              <i class="fas fa-paper-plane"></i> Kirim Laporan
            </button>
          </form>
        </div>
      </section>

      <section id="section-leaderboard" class="hidden space-y-4 animate-in fade-in duration-500">
         <div class="card-dashboard p-6">
            <div class="flex items-center gap-3 mb-6">
              <span class="p-3 bg-amber-100 text-amber-600 rounded-xl"><i class="fas fa-trophy"></i></span>
              <h2 class="text-xl font-bold text-slate-800">Papan Peringkat</h2>
            </div>
            <div id="lb-list" class="space-y-1">
              </div>
         </div>
      </section>

      <section id="section-history" class="hidden space-y-4 animate-in fade-in duration-500">
         <div class="card-dashboard p-6">
            <div class="flex items-center gap-3 mb-6">
              <span class="p-3 bg-slate-100 text-slate-600 rounded-xl"><i class="fas fa-clipboard-list"></i></span>
              <h2 class="text-xl font-bold text-slate-800">Semua Riwayat</h2>
            </div>
            <div id="hist-list" class="space-y-4">
              </div>
         </div>
      </section>
    </main>
  </div>

  <script>
    const WEB_URL = 'https://script.google.com/macros/s/AKfycby_hQWLOUkhMYETzOcFeo_OA4Tg7R7-2LkgYCVVVVC4Zia_qIkycUfD8YHrJ3Iuf17xdg/exec';
    let DB = [];

    function localISODate() { return new Date().toLocaleDateString('en-CA'); }
    function escapeHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }
    
    function formatDate(s) { 
      if(!s || s==='-') return '-';
      const d = new Date(s.split('T')[0]);
      return d.toLocaleDateString('id-ID', {day:'numeric', month:'short'});
    }

    function showSection(name) {
      ['dashboard', 'form', 'leaderboard', 'history'].forEach(s => {
        document.getElementById('section-' + s).classList.add('hidden');
        document.getElementById('tab-' + s).classList.replace('tab-active', 'tab-inactive');
      });
      document.getElementById('section-' + name).classList.remove('hidden');
      document.getElementById('tab-' + name).classList.replace('tab-inactive', 'tab-active');
      window.scrollTo({top: 0, behavior: 'smooth'});
    }

    async function init() {
      try {
        document.getElementById('f-tgl').value = localISODate();
        const nJson = await fetch(WEB_URL + '?action=names').then(r => r.json());
        const sel = document.getElementById('f-nama');
        nJson.data.forEach(p => {
          const o = new Option(p.nama, p.nama);
          o.dataset.klp = p.kelompok;
          sel.add(o);
        });
        sel.onchange = (e) => document.getElementById('f-klp').value = e.target.options[e.target.selectedIndex].dataset.klp || '';
        await loadReports();
      } catch (e) {
        console.error("Init Error:", e);
      }
    }

    async function loadReports() {
      const rJson = await fetch(WEB_URL + '?action=reports&t=' + Date.now()).then(r => r.json());
      DB = rJson.data || [];
      updateUI();
    }

    function updateUI() {
      const hariIni = localISODate();
      const totalLapHariIni = DB.filter(r => r.tanggal === hariIni).length;
      
      const rekap = {};
      DB.forEach(r => { 
        rekap[r.nama_lengkap] = (rekap[r.nama_lengkap] || 0) + (parseFloat(r.jumlah_juz) || 0); 
      });
      
      const khatamCount = Object.values(rekap).filter(v => v >= 30).length;

      document.getElementById('stat-total').textContent = DB.length;
      document.getElementById('stat-today').textContent = totalLapHariIni;
      document.getElementById('stat-khatam').textContent = khatamCount;

      const totalJuz = DB.reduce((s, r) => s + (parseFloat(r.jumlah_juz) || 0), 0);
      const prog = Math.min(100, (totalJuz / 30) * 100);
      document.getElementById('prog-pct').textContent = prog.toFixed(1) + '%';
      document.getElementById('prog-bar').style.width = prog + '%';

      // Recent List
      document.getElementById('recent-list').innerHTML = DB.slice(0, 5).map(r => `
        <div class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100">
          <div class="flex items-center gap-3">
             <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-emerald-600 shadow-sm border border-slate-100"><i class="fas ${r.kelompok==='Ikhwah'?'fa-mars text-blue-500':'fa-venus text-pink-500'}"></i></div>
             <div>
                <div class="font-bold text-slate-800">${escapeHtml(r.nama_lengkap)}</div>
                <div class="text-[11px] font-semibold text-slate-400">HARI ${r.hari_ramadan} • ${r.jumlah_juz} JUZ</div>
             </div>
          </div>
          <div class="text-[10px] font-bold text-emerald-600 bg-emerald-50 px-3 py-1 rounded-full">${formatDate(r.tanggal)}</div>
        </div>`).join('') || '<p class="text-center text-slate-400 py-4">Belum ada laporan terbaru</p>';

      // Leaderboard
      const sorted = Object.entries(rekap).sort((a,b) => b[1] - a[1]).slice(0, 10);
      document.getElementById('lb-list').innerHTML = sorted.map(([n, v], i) => `
        <div class="flex items-center justify-between p-4 hover:bg-slate-50 transition-colors rounded-xl ${i < 3 ? 'bg-amber-50/30' : ''}">
          <div class="flex items-center gap-4">
            <span class="w-6 text-sm font-bold text-slate-400 text-center">${i+1}</span>
            <span class="font-semibold text-slate-700">${n}</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-sm font-bold text-emerald-600">${v.toFixed(1)}</span>
            <span class="text-[10px] font-bold text-slate-300 uppercase">Juz</span>
          </div>
        </div>`).join('') || '<p class="text-center text-slate-400 py-4">Belum ada data</p>';

      // History
      document.getElementById('hist-list').innerHTML = DB.map(r => `
        <div class="card-dashboard p-5 border-l-4 ${r.kelompok === 'Ikhwah' ? 'border-l-blue-400' : 'border-l-pink-400'}">
          <div class="flex justify-between items-start mb-2">
            <div class="font-bold text-slate-800">${escapeHtml(r.nama_lengkap)}</div>
            <span class="text-[10px] font-black uppercase text-slate-300">${r.kelompok}</span>
          </div>
          <div class="flex items-center gap-4 text-xs font-bold">
            <span class="text-slate-500"><i class="far fa-calendar-alt mr-1"></i> Hari ${r.hari_ramadan} • ${formatDate(r.tanggal)}</span>
            <span class="text-emerald-600"><i class="fas fa-book-open mr-1"></i> ${r.jumlah_juz} Juz</span>
          </div>
          ${r.catatan?`<div class="mt-3 text-xs italic text-slate-400 bg-slate-50 p-2 rounded-lg border border-slate-100">"${escapeHtml(r.catatan)}"</div>`:''}
        </div>`).join('') || '<p class="text-center text-slate-400 py-4">Belum ada riwayat</p>';
    }

    document.getElementById('report-form').onsubmit = async (e) => {
      e.preventDefault();
      const btn = document.getElementById('f-btn');
      btn.disabled = true; 
      btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Mengirim...';
      
      const body = new URLSearchParams({
        action: 'create',
        nama_lengkap: document.getElementById('f-nama').value,
        kelompok: document.getElementById('f-klp').value,
        hari_ramadan: document.getElementById('f-hari').value,
        tanggal: document.getElementById('f-tgl').value,
        jumlah_juz: document.getElementById('f-juz').value,
        catatan: document.getElementById('f-catatan').value
      });

      try {
        await fetch(WEB_URL, { method: 'POST', body });
        location.reload();
      } catch (err) {
        alert("Gagal mengirim laporan. Coba lagi.");
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-paper-plane"></i> Kirim Laporan';
      }
    };

    init();
  </script>
</body>
</html>
